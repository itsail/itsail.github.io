<!DOCTYPE html><html lang="ru"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title> [CLI] Работа с изображениями в линуксе</title><meta name="description" content="В наше время всё чаще сайты сталкиваются с необходимостью введения отзывчивого дизайна и отзывчивых картинок – а в связи с этим есть необходимость эффективно..."><link rel="alternate" type="application/rss+xml" title="ITSail" href="/feed.xml"><link rel="canonical" href="https://blog.itsail.ru/blog/cli-working-with-images-in-linux/"><meta name="google-site-verification" content=""><meta name="yandex-verification" content="47167892cb6faab8" /><link href='https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans+Narrow:700&subset=latin,cyrillic' rel='stylesheet' type='text/css'><link rel="stylesheet" href="/assets/styles/main.css"><link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" /><meta property="og:url" content="https://blog.itsail.ru/blog/cli-working-with-images-in-linux/"><meta property="og:type" content="website"><meta property="og:title" content="[CLI] Работа с изображениями в линуксе"><meta property="og:description" content="Спецсимволы HTML, или символы-мнемоники, представляют собой конструкцию SGML, ссылающуюся на определенные символы из символьного набора документа"><meta property="og:site_name" content="ITSail"><meta name="twitter:card" content="summary"><meta name="twitter:url" content="https://blog.itsail.ru/blog/cli-working-with-images-in-linux/"><meta name="twitter:title" content="[CLI] Работа с изображениями в линуксе"><meta name="twitter:description" content="Спецсимволы HTML, или символы-мнемоники, представляют собой конструкцию SGML, ссылающуюся на определенные символы из символьного набора документа"><meta property="og:image" content="https://blog.itsail.ru/assets/images/2019/cli_working_with_images_in_linux_index.jpg"><meta name="twitter:image" content="https://blog.itsail.ru/assets/images/2019/cli_working_with_images_in_linux_index.jpg"><meta property="og:image" content="https://blog.itsail.ru/assets/images/2019/cli_working_with_images_in_linux_537x240.jpg"><meta name="twitter:image" content="https://blog.itsail.ru/assets/images/2019/cli_working_with_images_in_linux_537x240.jpg"><meta property="og:image" content="https://blog.itsail.ru/assets/images/2019/cli_working_with_images_in_linux_1200x630.jpg"><meta name="twitter:image" content="https://blog.itsail.ru/assets/images/2019/cli_working_with_images_in_linux_1200x630.jpg"><meta property="og:image" content="https://blog.itsail.ru/assets/images/2019/cli_working_with_images_in_linux_1080x1080.jpg"><meta name="twitter:image" content="https://blog.itsail.ru/assets/images/2019/cli_working_with_images_in_linux_1080x1080.jpg"><meta property="og:image" content="https://blog.itsail.ru/assets/images/2019/cli_working_with_images_in_linux_1680x1680.jpg"><meta name="twitter:image" content="https://blog.itsail.ru/assets/images/2019/cli_working_with_images_in_linux_1680x1680.jpg"><meta property="og:image" content="https://blog.itsail.ru/assets/images/2019/cli_working_with_images_in_linux_1024x512.jpg"><meta name="twitter:image" content="https://blog.itsail.ru/assets/images/2019/cli_working_with_images_in_linux_1024x512.jpg"><meta property="og:image" content="https://blog.itsail.ru/assets/images/2019/cli_working_with_images_in_linux_700x500.jpg"><meta name="twitter:image" content="https://blog.itsail.ru/assets/images/2019/cli_working_with_images_in_linux_700x500.jpg"><body><div id="shadow"></div><header class="main-header content-wrapper"> <input type="checkbox" id="menu-checkbox" /><nav class="center-wrapper nav-main"> <a class="blog-logo" href="/">ITSail</a> <a href="/about/">Об этом блоге</a> <a href="/blog/">Блог</a> <a href="/feed.xml">RSS</a> <label for="menu-checkbox" class="toggle-button" data-open="☰" data-close="☰" onclick></label></nav></header><aside class="sidebar" role="note" style="background-image: url(/assets/images/2019/cli_working_with_images_in_linux_index.jpg)"><div class="cover"><div class="cover-text"><div class="heading"> <a href="/blog/#Линукс">Линукс</a> <a href="/blog/#Разработка">Разработка</a></div><p>Спецсимволы HTML, или символы-мнемоники, представляют собой конструкцию SGML, ссылающуюся на определенные символы из символьного набора документа</p></div></div><div id="switcher"></div></aside><main class="content-wrapper"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><h1 class="post-title" itemprop="name headline">[CLI] Работа с изображениями в линуксе</h1><p class="post-meta"> <time datetime="2017-01-09">09-01-2017</time> &nbsp;/&nbsp; <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">idoka</span> &nbsp;/&nbsp; <a itemprop="url" rel="nofollow" href="http://idoka.ru/" target="_blank">Источник</a> </span> <span class="hidden" itemprop="datePublished" content="2017-01-09"></span></p><div class="post-content" itemprop="articleBody"><p>В наше время всё чаще сайты сталкиваются с необходимостью введения отзывчивого дизайна и отзывчивых картинок – а в связи с этим есть необходимость эффективного изменения размера всех картинок. Система должна работать так, чтобы каждому пользователю по запросу отправлялась картинка нужного размера – маленькие для пользователей с небольшими экранами, большие – для больших экранов.</p><p>Веб таким образом работает отлично, но для доставки картинок разных размеров разным пользователям необходимо все эти картинки сначала создать.</p><p>Множество инструментов занимается изменением размера, но слишком часто они выдают большие файлы, аннулирующие выигрыш в быстродействии, который должен приходить вместе с отзывчивыми картинками. Давайте рассмотрим, как при помощи ImageMagick, инструмента командной строки, быстренько изменять размеры картинок, сохраняя превосходное качество и получая файлы небольших объёмов.</p><h2 id="imagemagick-однострочники">ImageMagick: однострочники</h2><h3 id="Узнать-размеры-изображения">Узнать размеры изображения</h3><p>По вертикали:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">height</span><span class="o">=</span><span class="sb">`</span>identify <span class="nt">-ping</span> <span class="nt">-format</span> <span class="s2">"%h"</span> IMG_4450.JPG<span class="sb">`</span>
</code></pre></div></div><p>По горизонтали:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">width</span><span class="o">=</span><span class="sb">`</span>identify <span class="nt">-ping</span> <span class="nt">-format</span> <span class="s2">"%w"</span> IMG_4450.JPG<span class="sb">`</span>
</code></pre></div></div><h3 id="Склейка-нескольких-картинок-в-один-файл">Склейка нескольких картинок в один файл</h3><p>Склеить все изображения в директории в матрицу 2х2 по 4 изображения:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>montage <span class="k">*</span>.jpg <span class="nt">-tile</span> 2x2 <span class="nt">-geometry</span> +10+10 out.jpg
</code></pre></div></div><p>Склеить 2 изображения в столбец 1х2 (по вертикали):</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>montage BMW_420d.jpg BMW_425d.jpg <span class="nt">-tile</span> 1x2 <span class="nt">-geometry</span> +10+10 BMW_xDrive.jpg
</code></pre></div></div><p>Склеить 2 изображения в строку 2х1 (по горизонтали):</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>montage BMW_520d.jpg BMW_525d.jpg <span class="nt">-tile</span> 2x1 <span class="nt">-geometry</span> +10+10 BMW_M5.jpg
</code></pre></div></div><p>Подписать каждое изображение в коллаже именем файла:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>montage <span class="k">*</span>.jpg <span class="nt">-label</span> %f <span class="nt">-frame</span> 10 <span class="nt">-tile</span> 2x2 <span class="nt">-geometry</span> +10+10 out.jpg
</code></pre></div></div><p>здесь:</p><ul><li><code class="highlighter-rouge">-geometry +10+10</code> — белые поля вокруг каждого изображения, заданные в пикселях<li><code class="highlighter-rouge">-frame 10</code> — 3D-рамка, пиксели<li><code class="highlighter-rouge">-label %f</code> — подпись</ul><h3 id="Рассово-верный-резайс-картинок">Рассово-верный резайс картинок</h3><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>convert guy_fawkes.png <span class="nt">-adaptive-resize</span> 500x guy_fawkes_500x.png
</code></pre></div></div><p>Устаревший способ с ручным способом повышения чёткости картинки:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>convert <span class="nv">$1</span> <span class="nt">-filter</span> Lanczos <span class="nt">-sharpen</span> <span class="nv">$sharp</span> <span class="nt">-quality</span> <span class="nv">$quality</span> <span class="nt">-resize</span> <span class="nv">$newsize</span> <span class="nt">-verbose</span> <span class="nv">$2</span>
</code></pre></div></div><h3 id="Растяжение-гистограммы-изображения-повышение-цветовой-чёткости">Растяжение гистограммы изображения (повышение цветовой чёткости)</h3><p>Автоматический режим через normalize (также см. -auto-level и -auto-gamma):</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>convert <span class="nv">$1</span> <span class="nt">-normalize</span> <span class="nt">-sharpen</span> <span class="nv">$sharp</span> <span class="nt">-quality</span> <span class="nv">$quality</span> <span class="nt">-resize</span> <span class="nv">$newsize</span> <span class="nv">$2</span>
</code></pre></div></div><p>Ручное задание через linear-stretch на сколько % (в пикселях) снизу и сверху подвинуть гистограмму, можно задавать два числа в формате 5%x5%, также может использоваться с модификатором -channel:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>convert <span class="nv">$1</span> <span class="nt">-linear-stretch</span> 7% <span class="nt">-quality</span> <span class="nv">$quality</span> <span class="nt">-resize</span> <span class="nv">$newsize</span> <span class="nv">$2</span>
</code></pre></div></div><p>или через повышение контраста:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>convert <span class="nv">$1</span> <span class="nt">-contrast-stretch</span> 5%x5% <span class="nt">-quality</span> <span class="nv">$quality</span> <span class="nt">-resize</span> <span class="nv">$newsize</span> <span class="nv">$2</span>
</code></pre></div></div><p><em>Тонкие подробности: https://www.imagemagick.org/Usage/color_mods/#stretching</em></p><h3 id="Подмена-цвета">Подмена цвета</h3><p>Если у нас есть, например, QR-код после онлайн-генератора, окрашенный в стандартный черный цвет, а мы хотим выкрасить его в один из корпоративных цветов (например, для вставки в CV или на визитку), сделать это можно следующей командой:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>convert create-qr-code.png <span class="nt">-fuzz</span> 0% <span class="nt">-fill</span> <span class="s1">'#39а'</span> <span class="nt">-opaque</span> <span class="s1">'#000'</span> qr-code-kaspersky.png
</code></pre></div></div><p>здесь:</p><ul><li><code class="highlighter-rouge">-opaque '#000'</code> — какой цвет искать<li><code class="highlighter-rouge">-fill '#39а'</code> — на какой подменять<li><code class="highlighter-rouge">-fuzz 0%</code> — точность задания цвета (отклонение 0%, т.е. искать и подменять только точно совпадающий с #000 цветом)</ul><p>Если у нас картинка в полутонах, то задаём выше допустимое отклонение:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>convert guy_fawkes.png <span class="nt">-fuzz</span> 80% <span class="nt">-fill</span> <span class="s1">'#39а'</span> <span class="nt">-opaque</span> <span class="s1">'#000'</span> guy_fawkes_kaspersky.png
</code></pre></div></div><h3 id="Посмотреть-список-доступных-шрифтов">Посмотреть список доступных шрифтов</h3><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>convert <span class="nt">-list</span> font | <span class="nb">grep </span>Font | <span class="nb">grep</span> <span class="nt">-i</span> имя_шрифта
</code></pre></div></div><p>Именно выводимое название следует использовать для опции <code class="highlighter-rouge">-font</code> команды <code class="highlighter-rouge">convert</code>.</p><h2 id="Оптимизация-изображений">Оптимизация изображений</h2><h3 id="jpeg">JPEG</h3><p>Установка <code class="highlighter-rouge">jpegtran</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>yum search jpegtran
libjpeg-turbo-utils.x86_64 : Utilities <span class="k">for </span>manipulating JPEG images
<span class="nv">$ </span><span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> libjpeg-turbo-utils
</code></pre></div></div><p>Использование:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jpegtran <span class="nt">-copy</span> none <span class="nt">-optimize</span> <span class="nt">-outfile</span> <span class="nv">$file_out</span> <span class="nv">$file_in</span>
</code></pre></div></div><p>Второй доступный инструмент — <code class="highlighter-rouge">jpegoptim</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> jpegoptim
</code></pre></div></div><p>Использование:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jpegoptim <span class="nt">--quiet</span> <span class="nt">--strip-all</span> <span class="nt">--stdout</span> <span class="nv">$file_in</span> <span class="o">&gt;</span> <span class="nv">$file_out</span>
</code></pre></div></div><p>С данными настройками оба тула дают идентичный размер выходных файлов.</p><p>Для размещения файлов в сети желательно использовать опцию progressive, например, для <code class="highlighter-rouge">jpegoptim</code>:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jpegoptim <span class="nt">--quiet</span> <span class="nt">--strip-all</span> <span class="nt">--all-progressive</span> <span class="nt">--stdout</span> <span class="nv">$file_in</span> <span class="o">&gt;</span> <span class="nv">$file_out</span>
</code></pre></div></div><h3 id="png">PNG</h3><p>Что доступно в репах:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>advancecomp.x86_64 : Recompression utilities <span class="k">for</span> .PNG, .MNG and .ZIP files
optipng.x86_64     : PNG optimizer and converter
pngcrush.x86_64    : Optimizer <span class="k">for </span>PNG <span class="o">(</span>Portable Network Graphics<span class="o">)</span> files
pngnq.x86_64       : Pngnq is a tool <span class="k">for </span>quantizing PNG images <span class="k">in </span>RGBA format
pngquant.x86_64    : PNG quantization tool <span class="k">for </span>reducing image file size
</code></pre></div></div><p>Устанавливаем:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> optipng advancecomp pngcrush pngnq pngquant
</code></pre></div></div><p>Жмём:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>optipng <span class="nt">-o7</span> <span class="nt">-out</span> automotive_logofeature-optipng.png automotive_logofeature.png
advpng <span class="nt">-z</span> <span class="nt">-4</span> <span class="nt">-i</span> 50 automotive_logofeature-advpng.png
advdef <span class="nt">-z</span> <span class="nt">-4</span> <span class="nt">-i</span> 50 automotive_logofeature-advdef.png
pngcrush <span class="nt">-brute</span> <span class="nt">-reduce</span> automotive_logofeature.png automotive_logofeature-pngcrush.png
pngnq <span class="nt">-s</span> 1 <span class="nt">-v</span> automotive_logofeature-pngnq.png
pngquant <span class="nt">--speed</span> 1 <span class="nt">--force</span> automotive_logofeature-pngquant.png
</code></pre></div></div><p>Результаты:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>58019 байт  -  automotive_logofeature-оригинал.png
55449 байт  -  automotive_logofeature-optipng.png
53224 байт  -  automotive_logofeature-advdef.png
52086 байт  -  automotive_logofeature-pngcrush.png
38080 байт  -  automotive_logofeature-advpng.png
30961 байт  -  automotive_logofeature-pngquant.png
15796 байт  -  automotive_logofeature-pngnq.png
</code></pre></div></div><p>Тройка лидеров:</p><ol><li><strong>pngnq</strong> (ужал ~4 раза)<li><strong>pngquant</strong> (ужал ~2 раза)<li><strong>advpng</strong> (ужал ~1.5 раза)</ol><blockquote><p>Однако всплыло одно но: <code class="highlighter-rouge">advpng</code> умеет оптимизировать изображения, которые по какой-то причине не ужимают ни <code class="highlighter-rouge">pngnq</code>, ни <code class="highlighter-rouge">pngquant</code>: Google PageSpeed перестал жаловаться только после дополнительного прохода по файлам утилитой <code class="highlighter-rouge">advpng</code>.</p></blockquote><h3 id="svg">SVG</h3><h4 id="batik-svgpp">batik-svgpp</h4><p>Batik SVG pretty printer — The SVG Pretty Printer lets developers «pretty-up» their SVG files and get their tabulations and other cosmetic parameters in order. It can also be used to modify the DOCTYPE declaration on SVG files</p><h4 id="svgcleaner">svgcleaner</h4><p>Пакетная очистка SVG-файлов от ненужной информации, утилита удаляет атрибуты, не участвующие в формировании конечного изображения, а задействованные атрибуты приводит к более компактному виду. Размер файла может быть уменьшен на 60%.</p><blockquote><p>Поскольку удаляется информация и в выключеных/скрытых слоях, то утилиту стоит рассматривать как инструмент подготовки <code class="highlighter-rouge">publishing svg-files</code>.</p></blockquote><p>Зависимости:</p><ul><li>libxcb-xinerama0<li>p7zip</ul><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>yum <span class="nb">install</span> <span class="nt">-y</span> p7zip libXinerama libXinerama-devel
</code></pre></div></div><p>Запуск:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./svgcleaner input.svg output.svg
</code></pre></div></div><a class="link-to-post" href="/blog/black-methods-of-website-promotion/"> <span class="link-to-post__next">&#10535; &nbsp;Следующая запись</span> <span class="link-to-post__title">Черные методы продвижения сайтов. Что не стоит делать, если хотите вывести сайт в ТОП</span> </a></div></article></main><footer class="blog-footer content-wrapper"><p>&copy; <span class="full-year"></span> ITSail</p></footer><script src="/assets/scripts/scripts.min.js"></script> <script type="text/javascript" > (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)}; m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)}) (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym"); ym(52279162, "init", { id:52279162, clickmap:true, trackLinks:true, accurateTrackBounce:true, webvisor:true, trackHash:true }); </script> <noscript><div><img src="https://mc.yandex.ru/watch/52279162" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
